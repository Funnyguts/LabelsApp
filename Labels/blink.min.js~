fname=["node","back","root","timer","moves","giver","receiver","metaNode"];var mover=document.getElementById("wrap");var d="";var e="";var b="";var root=0;var firstload=1;var querystring="";var backIt="start";var content;var old;var use;var giver;var receiver;var deadX="";var deadEvent="";var links=1;var back=1;var scrollPosition;var invText="";var inv=1;var metaNode=0;var metaContent;var wait;var dCount=1;var f=[];f.node="start";f.back="start";f.root="start";f.metaNode=0;fname=fname.concat(userVariables);for(i in fname){f[fname[i]]=0}function createDeadLinks(c){deadxLinkNum=c.split("{").length-1;for(var g=0;g<deadxLinkNum;g++){y=c.replace(/^.*\{(.*)}.*$/,"$1");ysplit=y.split("|");parsedUrl="<span class='deadLink'>"+ysplit[0]+"</span>";y="{"+y+"}";c=c.replace(y,parsedUrl)}return c}function convertDeadLinks(c){deadxLinkNum=c.split("<").length-1;for(var g=0;g<deadxLinkNum;g++){y=c.replace(/^.*\<a(.*)a>.*$/,"$1");parsedUrl="";y="<"+y+">";c=c.replace(y,parsedUrl)}return c}function createLinks(a){var h=a.split("{").length-1;for(var c=0;c<h;c++){y=a.replace(/^.*\{(.*)}.*$/,"$1");var g=y.split("|");parsedUrl='<a href="#a" onClick="process(\''+g[1]+"');\">"+g[0]+"</a>";y="{"+y+"}";a=a.replace(y,parsedUrl)}return a}function pageHeight(){return window.innerHeight!=null?window.innerHeight:document.body!=null?document.body.clientHeight:null}function process(a){if(!ie){$.scrollTo("-=1px")}scrollPosition=window.pageYOffset;if(!firstload){document.getElementById("new").innerHTML=createDeadLinks(deadX);document.getElementById("new").setAttribute("class","old");document.getElementById("new").removeAttribute("id")}use=0;f.node=a;if(metaNode){f.back=="metaNode";metaNode=0}else{f.back=backIt}if(firstload){query=window.location.search.substring(1);f.node="start";f.back="start";f.root="start"}if(query&&firstload){document.getElementById("title").setAttribute("id","inner");var l=query.split("|");for(var j=0;j<=fname.length;j++){if(l[j]=="0"){l[j]=0}f[fname[j]]=l[j]}a=f.node}else{if(firstload&&!query){document.getElementById("startScreenInner").innerHTML="<h1>"+gameTitle+"</h1><h2>by "+gameAuthor+"</h2>";if(readCookie("state")){document.getElementById("startScreenInner").innerHTML+='<p>Do you want to <a href="#a" onClick="restore();">continue</a> or start a <a href="#a" onClick="newList();">new list</a>?</p>'}else{document.getElementById("startScreenInner").innerHTML+='<p>Start a <a href="#a" onClick="newList();">new list</a></p>'}}}var k=a+"|";for(var j=1;j<fname.length;j++){k+=f[fname[j]]+"|"}var h=500-fname.length;for(var j=0;j<h;j++){k+="0|"}k=k.substring(0,k.length-1);if(!firstload){setCookie("state",k,360);var c=readCookie("state")}for(var j=1;j<fname.length;j++){}if(metaNode){backIt="metaNode"}else{backIt=f.node}if(f.giver!=0){interactions()}else{for(j in fname){if(f[fname[j]]=="0"){f[fname[j]]=0}}story();if(!metaNode&&f.back!="metaNode"){if(root){f.timer++}f.moves++}else{if(metaNode){f.back="metaNode"}}}if(e){e='<div class="event">'+e+"</div>"}if(b){b='<div class="event">'+b+"</div>"}if(!links){d=createDeadLinks(d)}d=b+d+e;if(query&&firstload){d="<div class='metaText'><h2>Save/Restore Point:</h2><p><strong>Bookmark this page</strong> to return here later.</p><p>The game also automatically saves your progress: you can leave the game and click 'continue' from the start page at a later time. (Cookies need to be enabled)</p></div><br>"+d}if(root){f.root=a}deadX=d;if(back&&!root&&links){build('<p class="back">{Back|')+build(f.root)+build("}</p>")}else{if(root&&waitSystem&&links&&wait!=0||wait){d+='<p class="back">{Wait|'+f.root+"}</p>"}}d=createLinks(d);document.getElementById("content").innerHTML+='<div id="new"></div>';document.getElementById("new").innerHTML+=d;d="";e="";b="";if(inventorySystem){includeInv();if(!links||inv==0){invText=createDeadLinks(invText);document.getElementById("rail").innerHTML="<div id=\"inventory\" ><h2>Your Labels:</h2><div id='list'>"+invText+"</div></div>"}else{if(use||root&&links){var n=invText.split("{").length-1;for(var j=0;j<n;j++){y=invText.replace(/^.*\{(.*)}.*$/,"$1");var m=y.split("|");parsedUrl='<a href="#a" onClick="inventory(\''+m[1]+"','"+f.node+"')\">"+m[0]+"</a>";y="{"+y+"}";invText=invText.replace(y,parsedUrl)}build(invText);var g;if(use){g="<div id=\"inventory\" class='use'><h2>Use:</h2><div id=\"arrow\"></div><div id='list'>"+d+"</div></div>"}else{g="<div id=\"inventory\"><h2>Your Labels:</h2><div id='list'>"+d+"</div></div>"}if(inv){document.getElementById("rail").innerHTML=g}}else{invText=createDeadLinks(invText);document.getElementById("rail").innerHTML="<div id=\"inventory\" ><h2>Your Labels:</h2><div id='list'>"+invText+"</div></div>"}}invText=""}d="";if(f.moves<2||query){saveLink="<span class='deadLink'>Save Game</span>"}else{saveLink='<a href="?'+k+'">Save Game</a> '}document.getElementById("meta").innerHTML='<a href="?">Restart</a> '+saveLink+createLinks(metaContent)+"<span class='fine'>Powered by <a href='http://bloomengine.com/blink' target='_blank'>Blink!</a></span>";f.giver=0;f.receiver=0;back=1;links=1;inv=1;if(waitSystem){wait=1}else{wait=0}root=0;if(firstload&&!query){toggleLayer("wrap")}if(firstload){firstload=0;query=0}$.scrollTo($("#new"),400);resize();jsprettify.prettify()}window.onresize=resize;function restore(){document.getElementById("title").setAttribute("id","inner");var a=readCookie("state");var g=a.split("|");for(var c=0;c<=fname.length;c++){f[fname[c]]=g[c]}toggleLayer("wrap");toggleLayer("startScreen");deadX="<h2>Restored game</h2>";process(f.node);$.scrollTo($("#new"),500)}function setCookie(j,h,g){var c=new Date();var a=new Date();if(g==null||g==0){g=1}a.setTime(c.getTime()+3600000*24*g);document.cookie=j+"="+escape(h)+";expires="+a.toGMTString()}function readCookie(h){var c=" "+document.cookie;var g=c.indexOf(" "+h+"=");if(g==-1){g=c.indexOf(";"+h+"=")}if(g==-1||h==""){return""}var a=c.indexOf(";",g+1);if(a==-1){a=c.length}return unescape(c.substring(g+h.length+2,a))}function toggleLayer(g){var a,c;if(document.getElementById){a=document.getElementById(g)}else{if(document.all){a=document.all[g]}else{if(document.layers){a=document.layers[g]}}}c=a.style;if(c.display==""&&a.offsetWidth!=undefined&&a.offsetHeight!=undefined){c.display=(a.offsetWidth!=0&&a.offsetHeight!=0)?"block":"none"}c.display=(c.display==""||c.display=="block")?"none":"block"}function newGame(){document.getElementById("title").setAttribute("id","inner");toggleLayer("wrap");toggleLayer("startScreen");document.getElementById("content").innerHTML='<div class="old"><h2>Begin</h2></div>'+document.getElementById("content").innerHTML;$.scrollTo($("#new"),500)}function resize(){var c;var a;if(typeof window.innerWidth!="undefined"){c=window.innerWidth,a=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0){c=document.documentElement.clientWidth,a=document.documentElement.clientHeight}else{c=document.getElementsByTagName("body")[0].clientWidth,a=document.getElementsByTagName("body")[0].clientHeight}}document.getElementById("list").style.maxHeight=a-120+"px";document.getElementById("content").style.minHeight=a-60+"px"}function t(c){if(f[c]==1){return true}else{return false}}function scroll(){}function inventory(g,c){if(use){f.giver=g;f.receiver=c}process(g)}function build(c){d=d+c}function buildInv(c){invText=invText+c}function event(c){e=e+c}function buildNew(c){d=c}function pageWidth(){return window.innerWidth!=null?window.innerWidth:document.body!=null?document.body.clientWidth:null}function pageHeight(){return window.innerHeight!=null?window.innerHeight:document.body!=null?document.body.clientHeight:null}function form_params(g){var h=new Array();var c=g.elements.length;for(var a=0;a<c;a++){element=g.elements[a];if(element.tagName=="TEXTAREA"){h[element.name]=element.value}else{if(element.tagName=="INPUT"){if(element.type=="text"||element.type=="hidden"||element.type=="password"){h[element.name]=element.value}else{if(element.type=="radio"&&element.checked){if(!element.value){h[element.name]="on"}else{h[element.name]=element.value}}else{if(element.type=="checkbox"&&element.checked){if(!element.value){h[element.name]="on"}else{h[element.name]=element.value}}}}}}}return h}function serialize(k){if(!k||!k.elements){return}var g=[],h,c,m;var l=function(j,n){g.push(encodeURIComponent(j)+"="+encodeURIComponent(n))};var a=k.elements;for(h=0;h<a.length;h+=1,m=false){if(a[h].name.length>0){switch(a[h].type){case"select-one":m=true;case"select-multiple":for(c=0;c<a[h].options.length;c+=1){if(a[h].options[c].selected){l(a[h].name,a[h].options[c].value);if(m){break}}}break;case"checkbox":case"radio":if(!a[h].checked){break}default:l(a[h].name,a[h].value);break}}}return g.join("&")}function story(){f.moves=Number(f.moves);nodes();dt='<form id="debugForm"  action="formHandler.php" method="post">';for(i in fname){dt+='<div class="form_block"><label>';dt+=fname[i];dt+=": </label>";dt+='<input type="text" id="';dt+=fname[i];dt+='" name="';dt+=fname[i];dt+='" value="';dt+=f[fname[i]];dt+='"  />';dt+="</div>"}dt+='<input type="submit" class="button" />';dt+="</form>";name_element=document.getElementById("dc");if(debugMode){document.getElementById("debug").innerHTML=dt}};
